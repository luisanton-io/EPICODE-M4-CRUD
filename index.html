<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>

    <div class="container mt-5">
        <h1>EPICODE Agenda</h1>
        <div id="main-row" class="row">

        </div>
        <hr>
        <h3>Add Event</h3>
        <form class="row" onsubmit="addToAgenda(event)">
            <div class="col-3">
                <label>Name</label>
                <input required id="name" type="text" class="form-control" placeholder="John Doe Live">
            </div>
            <div class="col-3">
                <label>Description</label>
                <input required id="description" type="text" class="form-control" placeholder="First time in Europe">
            </div>
            <div class="col-3">
                <label>Price</label>
                <div class="d-flex align-items-center">
                    <span class="me-2">EUR</span>
                    <input required id="price" type="text" class="form-control" placeholder="50">
                </div>
            </div>
            <div class="col-3">
                <label>Date and Time</label>

                <div class="d-flex align-items-center">
                    <input required id="time" type="datetime-local" class="form-control">
                    <button class="ms-2 btn btn-primary">Add</button>
                </div>
            </div>
        </form>
    </div>



    <script>

        const row = document.querySelector("#main-row")

        const name = document.querySelector("#name")
        const description = document.querySelector("#description")
        const price = document.querySelector("#price")
        const time = document.querySelector("#time")

        // Endpoint: https://striveschool-api.herokuapp.com/api/agenda

        async function getAgenda() {
            const response = await fetch("https://striveschool-api.herokuapp.com/api/agenda")
            const data = await response.json()
            console.log(data)
            return data
        }

        async function addToAgenda(event) {
            // In questa funzione andremo a fare una chiamata POST
            // Il nostro servizio REST la accoglierà e creerà la risorsa
            event.preventDefault()

            const response = await fetch("https://striveschool-api.herokuapp.com/api/agenda", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: name.value,
                    description: description.value,
                    price: price.value,
                    time: time.value
                })
            })

            if (response.ok) { // response.ok == true se status è 2xx, altrimenti falso, se 4xx o 5xx
                alert("Yohoo! Added Event")
                const data = await getAgenda()
                displayAgenda(data)

                for (const field of [name, description, price, time]) {
                    field.value = ''
                }
            } else {
                console.error("Cannot send")
            }
        }

        function displayAgenda(data) {
            row.innerHTML = data.map(({ name, description, price, time }) => /*html*/`
                <div class="col-3">
                    ${name} 
                </div>    
                <div class="col-3">
                    ${description} 
                </div>    
                <div class="col-3">
                    EUR ${price}
                </div>    
                <div class="col-3">
                    ${new Date(time).toLocaleDateString()} ${new Date(time).toLocaleTimeString()}
                </div>    
            `).join("")
        }

        window.onload = async function () {
            try {
                const agendaData = await getAgenda()
                displayAgenda(agendaData)
            } catch (error) {
                console.log(error)
            }
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</body>

</html>